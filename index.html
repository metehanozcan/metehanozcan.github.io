<!DOCTYPE html>
<html lang="tr" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Pair Crypto Trading Signals</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'bg-light': '#FFFFFF',
                        'bg-dark': '#181818'
                    }
                }
            }
        }
    </script>
    <style>
        .notification-success {
            background: linear-gradient(135deg, #10B981, #059669);
        }
        .notification-danger {
            background: linear-gradient(135deg, #EF4444, #DC2626);
        }
        .pulse-ring {
            animation: pulse-ring 1.25s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.33); }
            80%, 100% { opacity: 0; }
        }
        .pair-card {
            transition: all 0.3s ease;
        }
        .pair-card:hover {
            transform: translateY(-2px);
        }
        .signal-animation {
            animation: signalPulse 0.6s ease-in-out;
        }
        @keyframes signalPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .chart-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }
        .dark .chart-container {
            background: #1f2937;
        }
        .sound-wave {
            animation: soundWave 0.8s ease-in-out;
        }
        @keyframes soundWave {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1); }
            50% { transform: scale(1.2); }
            75% { transform: scale(1.1); }
        }
        
        /* Theme-aware scrollbars */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-track {
            background: #374151;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #6b7280;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
    </style>
</head>
<body class="h-full bg-bg-light dark:bg-bg-dark text-gray-900 dark:text-white transition-colors duration-200">
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center">
                                <span class="text-white font-bold text-sm">‚Çø</span>
                            </div>
                            <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full pulse-ring" id="liveIndicator"></div>
                        </div>
                        <h1 class="text-xl font-semibold">Multi-Pair Trading Signals</h1>
                        <div class="bg-primary/10 text-primary px-3 py-1 rounded-full text-sm font-medium" id="activePairsCount">
                            0 aktif √ßift
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <!-- Theme Toggle -->
                        <button id="themeToggle" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                            <svg class="w-5 h-5 dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                            </svg>
                            <svg class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                            </svg>
                        </button>
                        
                        <!-- Sound Toggle -->
                        <button id="soundToggle" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors" title="Ses Ayarlarƒ±">
                            <svg class="w-5 h-5" id="soundIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 14.142M5 7h4l5-5v16l-5-5H5a2 2 0 01-2-2V9a2 2 0 012-2z"></path>
                            </svg>
                        </button>
                        
                        <!-- Notification Toggle -->
                        <button id="notificationBtn" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors">
                            üîî Bildirimleri Etkinle≈ütir
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-1 max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-8">
            <!-- Add Pair Section -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-8 border border-gray-200 dark:border-gray-700">
                <h2 class="text-lg font-semibold mb-6 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                    </svg>
                    Yeni √áift Ekle
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Sembol</label>
                        <select id="symbolSelect" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="">Sembol Se√ßin</option>
                            <option value="btcusdt">BTC/USDT</option>
                            <option value="ethusdt">ETH/USDT</option>
                            <option value="adausdt">ADA/USDT</option>
                            <option value="bnbusdt">BNB/USDT</option>
                            <option value="solusdt">SOL/USDT</option>
                            <option value="dogeusdt">DOGE/USDT</option>
                            <option value="xrpusdt">XRP/USDT</option>
                            <option value="avaxusdt">AVAX/USDT</option>
                            <option value="dotusdt">DOT/USDT</option>
                            <option value="maticusdt">MATIC/USDT</option>
                            <option value="linkusdt">LINK/USDT</option>
                            <option value="ltcusdt">LTC/USDT</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Zaman Dilimi</label>
                        <select id="intervalSelect" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="1m">1 Dakika</option>
                            <option value="3m" selected>3 Dakika</option>
                            <option value="5m">5 Dakika</option>
                            <option value="15m">15 Dakika</option>
                            <option value="30m">30 Dakika</option>
                            <option value="1h">1 Saat</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">EMA Ayarlarƒ±</label>
                        <div class="flex space-x-2">
                            <input type="number" id="emaShort" value="8" min="1" max="50" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="8">
                            <input type="number" id="emaLong" value="55" min="1" max="200" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="55">
                        </div>
                    </div>
                    
                    <div class="flex items-end">
                        <button id="addPairBtn" class="w-full px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-lg font-medium transition-colors">
                            ‚ûï √áift Ekle
                        </button>
                    </div>
                </div>

                <!-- Custom Symbol Input -->
                <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-600">
                    <div class="flex items-center space-x-4">
                        <div class="flex-1">
                            <label class="block text-sm font-medium mb-2">√ñzel Sembol (√∂rn: PEPEUSDT)</label>
                            <input type="text" id="customSymbol" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="SEMBOLUSD formatƒ±nda girin">
                        </div>
                        <button id="addCustomPairBtn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors">
                            √ñzel Ekle
                        </button>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 xl:grid-cols-4 gap-8">
                <!-- Active Pairs & Chart -->
                <div class="xl:col-span-3 space-y-8">
                    <!-- Charts Section -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
                        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                            <div class="flex justify-between items-center">
                                <h2 class="text-lg font-semibold flex items-center">
                                    üìà Price Charts
                                    <span class="ml-2 px-2 py-1 bg-green-100 dark:bg-green-900 text-green-600 text-xs rounded-full" id="chartStatus">LIVE</span>
                                </h2>
                                <div class="flex items-center space-x-3">
                                    <select id="chartType" class="px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent">
                                        <option value="custom">Custom Chart</option>
                                        <option value="tradingview">TradingView</option>
                                    </select>
                                    <select id="chartSymbol" class="px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent">
                                        <option value="btcusdt">BTC/USDT</option>
                                        <option value="ethusdt">ETH/USDT</option>
                                        <option value="adausdt">ADA/USDT</option>
                                        <option value="bnbusdt">BNB/USDT</option>
                                        <option value="solusdt">SOL/USDT</option>
                                    </select>
                                    <select id="chartInterval" class="px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent">
                                        <option value="1m">1m</option>
                                        <option value="3m" selected>3m</option>
                                        <option value="5m">5m</option>
                                        <option value="15m">15m</option>
                                    </select>
                                    <button id="refreshChart" class="p-1 text-gray-600 dark:text-gray-400 hover:text-primary transition-colors" title="Grafiƒüi Yenile">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Custom Chart.js Chart -->
                        <div class="chart-container p-4" id="customChartContainer">
                            <canvas id="priceChart" class="w-full h-80"></canvas>
                        </div>
                        
                        <!-- TradingView Widget -->
                        <div class="chart-container h-96" id="tradingViewContainer" style="display: none;">
                            <div class="tradingview-widget-container h-full w-full">
                                <div class="tradingview-widget-container__widget h-full w-full" id="tradingview_widget"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Active Pairs -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                        <h2 class="text-lg font-semibold mb-6 flex items-center justify-between">
                            <span>Aktif √áiftler</span>
                            <button id="clearAllBtn" class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm transition-colors">
                                Hepsini Temizle
                            </button>
                        </h2>
                        <div id="activePairs" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Pairs will be added here -->
                        </div>
                        <div id="noPairsMessage" class="text-center py-12 text-gray-500 dark:text-gray-400">
                            <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            <p class="text-lg">Hen√ºz √ßift eklenmemi≈ü</p>
                            <p class="text-sm">Yukarƒ±dan yeni √ßift ekleyerek ba≈ülayƒ±n</p>
                        </div>
                    </div>
                </div>

                <!-- Combined Signals Panel -->
                <div class="space-y-6">
                    <!-- Signal Statistics -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold mb-4">Sinyal ƒ∞statistikleri</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-green-600">Toplam AL:</span>
                                <span id="totalBuySignals" class="font-bold">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-red-600">Toplam SAT:</span>
                                <span id="totalSellSignals" class="font-bold">0</span>
                            </div>
                            <div class="border-t border-gray-200 dark:border-gray-600 pt-3">
                                <div class="flex justify-between">
                                    <span>Son Sinyal:</span>
                                    <span id="lastSignalTime" class="text-sm text-gray-500">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Latest Signal -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold mb-4">Son Sinyal</h3>
                        <div id="latestSignalCombined" class="text-center py-8 text-gray-500 dark:text-gray-400">
                            Hen√ºz sinyal yok
                        </div>
                    </div>

                    <!-- Combined Signal History -->
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold mb-4">T√ºm Sinyaller</h3>
                        <div id="combinedSignalHistory" class="space-y-2 max-h-80 overflow-y-auto custom-scrollbar">
                            <!-- Combined signals will be added here -->
                        </div>
                        <div id="noSignalsMessage" class="text-center py-8 text-gray-500 dark:text-gray-400">
                            Hen√ºz sinyal yok
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Notification Toast -->
    <div id="notificationToast" class="fixed top-4 right-4 transform translate-x-full transition-transform duration-300 z-50">
        <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg p-4 min-w-80">
            <div class="flex items-center">
                <div id="toastIcon" class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center mr-3">
                    <span class="text-white font-bold text-sm"></span>
                </div>
                <div class="flex-1">
                    <div id="toastTitle" class="font-semibold"></div>
                    <div id="toastMessage" class="text-sm text-gray-600 dark:text-gray-400"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Theme Management
        function initializeTheme() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            });
        }

        document.getElementById('themeToggle').addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
        });

        // Audio System for Signal Sounds
        class AudioSystem {
            constructor() {
                this.audioContext = null;
                this.soundEnabled = true;
                this.initAudio();
            }

            async initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Web Audio API not supported');
                }
            }

            // Generate beep sound for signals
            playSignalSound(type = 'buy') {
                if (!this.soundEnabled || !this.audioContext) return;

                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);

                // Different frequencies for buy/sell
                const frequency = type === 'buy' ? 800 : 400;
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);

                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + 0.5);
            }

            toggleSound() {
                this.soundEnabled = !this.soundEnabled;
                return this.soundEnabled;
            }
        }

        // Real-time Price Chart with Chart.js
        class RealTimePriceChart {
            constructor() {
                this.currentSymbol = 'btcusdt';
                this.currentInterval = '3m';
                this.chart = null;
                this.ws = null;
                this.priceData = [];
                this.timeLabels = [];
                this.maxDataPoints = 50;
                
                this.initChart();
                this.bindEvents();
                this.connectWebSocket();
            }

            initChart() {
                const ctx = document.getElementById('priceChart').getContext('2d');
                const isDark = document.documentElement.classList.contains('dark');
                
                this.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'Price',
                                data: [],
                                borderColor: '#5D5CDE',
                                backgroundColor: 'rgba(93, 92, 222, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: isDark ? '#1f2937' : '#ffffff',
                                titleColor: isDark ? '#ffffff' : '#000000',
                                bodyColor: isDark ? '#ffffff' : '#000000',
                                borderColor: isDark ? '#374151' : '#e5e7eb',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            x: {
                                display: true,
                                grid: {
                                    color: isDark ? 'rgba(107, 114, 128, 0.1)' : 'rgba(107, 114, 128, 0.1)'
                                },
                                ticks: {
                                    color: isDark ? '#9ca3af' : '#6b7280'
                                }
                            },
                            y: {
                                display: true,
                                grid: {
                                    color: isDark ? 'rgba(107, 114, 128, 0.1)' : 'rgba(107, 114, 128, 0.1)'
                                },
                                ticks: {
                                    color: isDark ? '#9ca3af' : '#6b7280'
                                }
                            }
                        },
                        animation: {
                            duration: 750
                        }
                    }
                });
            }

            bindEvents() {
                document.getElementById('chartSymbol').addEventListener('change', (e) => {
                    this.currentSymbol = e.target.value;
                    this.reconnect();
                });

                document.getElementById('chartInterval').addEventListener('change', (e) => {
                    this.currentInterval = e.target.value;
                    this.reconnect();
                });

                document.getElementById('refreshChart').addEventListener('click', () => {
                    this.reconnect();
                });

                // Update chart colors on theme change
                document.getElementById('themeToggle').addEventListener('click', () => {
                    setTimeout(() => this.updateChartTheme(), 100);
                });
            }

            updateChartTheme() {
                const isDark = document.documentElement.classList.contains('dark');
                
                this.chart.options.plugins.tooltip.backgroundColor = isDark ? '#1f2937' : '#ffffff';
                this.chart.options.plugins.tooltip.titleColor = isDark ? '#ffffff' : '#000000';
                this.chart.options.plugins.tooltip.bodyColor = isDark ? '#ffffff' : '#000000';
                this.chart.options.plugins.tooltip.borderColor = isDark ? '#374151' : '#e5e7eb';
                
                this.chart.options.scales.x.ticks.color = isDark ? '#9ca3af' : '#6b7280';
                this.chart.options.scales.y.ticks.color = isDark ? '#9ca3af' : '#6b7280';
                
                this.chart.update();
            }

            connectWebSocket() {
                this.updateStatus('connecting');
                
                if (this.ws) {
                    this.ws.close();
                }

                const stream = `${this.currentSymbol}@kline_${this.currentInterval}`;
                this.ws = new WebSocket(`wss://stream.binance.com:9443/ws/${stream}`);

                this.ws.onopen = () => {
                    this.updateStatus('connected');
                    console.log(`Chart connected to ${this.currentSymbol.toUpperCase()}`);
                };

                this.ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    this.handleKlineData(data);
                };

                this.ws.onerror = () => {
                    this.updateStatus('error');
                };

                this.ws.onclose = () => {
                    this.updateStatus('disconnected');
                    setTimeout(() => this.connectWebSocket(), 5000);
                };
            }

            handleKlineData(data) {
                if (!data.k) return;

                const kline = data.k;
                const price = parseFloat(kline.c);
                const time = new Date(kline.t).toLocaleTimeString();

                // Add new data point
                this.priceData.push(price);
                this.timeLabels.push(time);

                // Remove old data points if we have too many
                if (this.priceData.length > this.maxDataPoints) {
                    this.priceData.shift();
                    this.timeLabels.shift();
                }

                // Update chart
                this.chart.data.labels = this.timeLabels;
                this.chart.data.datasets[0].data = this.priceData;
                this.chart.data.datasets[0].label = `${this.currentSymbol.toUpperCase()} - $${price.toLocaleString()}`;
                this.chart.update('none'); // No animation for real-time updates
            }

            updateStatus(status) {
                const statusEl = document.getElementById('chartStatus');
                if (!statusEl) return;

                const statusConfig = {
                    connecting: { text: 'CONNECTING', class: 'bg-yellow-100 dark:bg-yellow-900 text-yellow-600' },
                    connected: { text: 'LIVE', class: 'bg-green-100 dark:bg-green-900 text-green-600' },
                    error: { text: 'ERROR', class: 'bg-red-100 dark:bg-red-900 text-red-600' },
                    disconnected: { text: 'OFFLINE', class: 'bg-gray-100 dark:bg-gray-900 text-gray-600' }
                };

                const config = statusConfig[status];
                statusEl.textContent = config.text;
                statusEl.className = `ml-2 px-2 py-1 text-xs rounded-full ${config.class}`;
            }

            reconnect() {
                this.priceData = [];
                this.timeLabels = [];
                this.chart.data.labels = [];
                this.chart.data.datasets[0].data = [];
                this.chart.update();
                this.connectWebSocket();
            }

            disconnect() {
                if (this.ws) {
                    this.ws.close();
                    this.ws = null;
                }
            }
        }

        // Multi-Pair Trading Signals System
        class MultiPairTradingSignals {
            constructor() {
                this.pairs = new Map(); // symbol -> PairTracker
                this.allSignals = [];
                this.notificationsEnabled = false;
                this.soundEnabled = true;
                this.signalStats = { buy: 0, sell: 0 };
                
                // Initialize audio system
                this.audioSystem = new AudioSystem();
                
                this.bindEvents();
                this.updateUI();
            }

            bindEvents() {
                document.getElementById('addPairBtn').addEventListener('click', () => {
                    this.addPair();
                });

                document.getElementById('addCustomPairBtn').addEventListener('click', () => {
                    this.addCustomPair();
                });

                document.getElementById('clearAllBtn').addEventListener('click', () => {
                    this.clearAllPairs();
                });

                document.getElementById('soundToggle').addEventListener('click', () => {
                    this.toggleSound();
                });

                document.getElementById('notificationBtn').addEventListener('click', () => {
                    this.enableNotifications();
                });
            }

            addPair() {
                const symbol = document.getElementById('symbolSelect').value;
                const interval = document.getElementById('intervalSelect').value;
                const emaShort = parseInt(document.getElementById('emaShort').value);
                const emaLong = parseInt(document.getElementById('emaLong').value);

                if (!symbol) {
                    this.showToast('danger', 'Hata!', 'L√ºtfen bir sembol se√ßin');
                    return;
                }

                this.addPairToSystem(symbol, interval, emaShort, emaLong);
            }

            addCustomPair() {
                const customSymbol = document.getElementById('customSymbol').value.toLowerCase().trim();
                const interval = document.getElementById('intervalSelect').value;
                const emaShort = parseInt(document.getElementById('emaShort').value);
                const emaLong = parseInt(document.getElementById('emaLong').value);

                if (!customSymbol) {
                    this.showToast('danger', 'Hata!', 'L√ºtfen bir sembol girin');
                    return;
                }

                // Basic validation
                if (!customSymbol.includes('usdt') && !customSymbol.includes('busd') && !customSymbol.includes('btc') && !customSymbol.includes('eth')) {
                    this.showToast('danger', 'Hata!', 'Ge√ßersiz sembol formatƒ±. √ñrn: PEPEUSDT');
                    return;
                }

                this.addPairToSystem(customSymbol, interval, emaShort, emaLong);
                document.getElementById('customSymbol').value = '';
            }

            addPairToSystem(symbol, interval, emaShort, emaLong) {
                const pairKey = `${symbol}_${interval}_${emaShort}_${emaLong}`;
                
                if (this.pairs.has(pairKey)) {
                    this.showToast('danger', 'Hata!', 'Bu √ßift zaten eklendi');
                    return;
                }

                const pairTracker = new PairTracker(symbol, interval, emaShort, emaLong, this);
                this.pairs.set(pairKey, pairTracker);
                
                this.createPairCard(pairKey, pairTracker);
                this.updateUI();
                
                this.showToast('success', 'Ba≈üarƒ±lƒ±!', `${symbol.toUpperCase()} √ßifti eklendi`);
            }

            createPairCard(pairKey, pairTracker) {
                const activePairsEl = document.getElementById('activePairs');
                const card = document.createElement('div');
                card.className = 'pair-card bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600';
                card.id = `pair_${pairKey}`;

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-bold text-lg">${pairTracker.symbol.toUpperCase()}</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400">${pairTracker.interval} ‚Ä¢ EMA ${pairTracker.emaShort}/${pairTracker.emaLong}</p>
                        </div>
                        <button onclick="multiPairApp.removePair('${pairKey}')" class="text-red-600 hover:text-red-700 p-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span>Fiyat:</span>
                            <span class="font-mono" id="price_${pairKey}">$0.00</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-green-600">EMA ${pairTracker.emaShort}:</span>
                            <span class="font-mono" id="ema_short_${pairKey}">$0.00</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-red-600">EMA ${pairTracker.emaLong}:</span>
                            <span class="font-mono" id="ema_long_${pairKey}">$0.00</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span>Durum:</span>
                            <span class="connection-status" id="status_${pairKey}">
                                <span class="w-2 h-2 bg-yellow-500 rounded-full inline-block"></span>
                                Baƒülanƒ±yor...
                            </span>
                        </div>
                        <div class="text-center pt-2" id="signal_${pairKey}">
                            <span class="text-xs text-gray-500">Sinyal bekleniyor...</span>
                        </div>
                    </div>
                `;

                activePairsEl.appendChild(card);
            }

            removePair(pairKey) {
                const pairTracker = this.pairs.get(pairKey);
                if (pairTracker) {
                    pairTracker.disconnect();
                    this.pairs.delete(pairKey);
                    
                    const cardEl = document.getElementById(`pair_${pairKey}`);
                    if (cardEl) {
                        cardEl.remove();
                    }
                    
                    this.updateUI();
                    this.showToast('success', 'Silindi!', `√áift kaldƒ±rƒ±ldƒ±`);
                }
            }

            clearAllPairs() {
                if (this.pairs.size === 0) return;

                this.pairs.forEach(pairTracker => pairTracker.disconnect());
                this.pairs.clear();
                
                document.getElementById('activePairs').innerHTML = '';
                this.allSignals = [];
                this.signalStats = { buy: 0, sell: 0 };
                
                this.updateUI();
                this.showToast('success', 'Temizlendi!', 'T√ºm √ßiftler kaldƒ±rƒ±ldƒ±');
            }

            addSignal(signal) {
                signal.id = Date.now() + Math.random();
                this.allSignals.unshift(signal);
                
                // Keep only last 100 signals
                if (this.allSignals.length > 100) {
                    this.allSignals = this.allSignals.slice(0, 100);
                }

                this.signalStats[signal.type.toLowerCase()]++;
                this.updateCombinedSignalsUI();
                this.showNotification(signal);
                this.playSignalSound(signal.type);
                this.showToast(
                    signal.type === 'BUY' ? 'success' : 'danger',
                    `${signal.type} Sinyali!`,
                    `${signal.symbol} - $${signal.price.toLocaleString()}`
                );
            }

            toggleSound() {
                this.soundEnabled = this.audioSystem.toggleSound();
                const soundIcon = document.getElementById('soundIcon');
                const soundToggle = document.getElementById('soundToggle');
                
                if (this.soundEnabled) {
                    soundIcon.innerHTML = `
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 14.142M5 7h4l5-5v16l-5-5H5a2 2 0 01-2-2V9a2 2 0 012-2z"></path>
                    `;
                    soundToggle.title = 'Ses A√ßƒ±k';
                    soundToggle.classList.remove('bg-red-100', 'dark:bg-red-900');
                    soundToggle.classList.add('bg-gray-100', 'dark:bg-gray-700');
                } else {
                    soundIcon.innerHTML = `
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a2 2 0 01-2-2V9a2 2 0 012-2h1.586l4.707-4.707C10.923 1.663 12 2.109 12 3v18c0 .891-1.077 1.337-1.707.707L5.586 15z" clip-rule="evenodd"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"></path>
                    `;
                    soundToggle.title = 'Ses Kapalƒ±';
                    soundToggle.classList.remove('bg-gray-100', 'dark:bg-gray-700');
                    soundToggle.classList.add('bg-red-100', 'dark:bg-red-900');
                }
                
                this.showToast('success', 'Ses Ayarƒ±', this.soundEnabled ? 'Ses a√ßƒ±ldƒ±' : 'Ses kapatƒ±ldƒ±');
            }

            playSignalSound(type) {
                if (this.soundEnabled) {
                    this.audioSystem.playSignalSound(type.toLowerCase());
                    
                    // Visual feedback
                    const soundToggle = document.getElementById('soundToggle');
                    soundToggle.classList.add('sound-wave');
                    setTimeout(() => {
                        soundToggle.classList.remove('sound-wave');
                    }, 800);
                }
            }

            updateCombinedSignalsUI() {
                // Update statistics
                document.getElementById('totalBuySignals').textContent = this.signalStats.buy;
                document.getElementById('totalSellSignals').textContent = this.signalStats.sell;
                
                if (this.allSignals.length > 0) {
                    document.getElementById('lastSignalTime').textContent = this.allSignals[0].timestamp.split(' ')[1];
                    
                    // Update latest signal
                    const latestSignal = this.allSignals[0];
                    const latestSignalEl = document.getElementById('latestSignalCombined');
                    const signalColor = latestSignal.type === 'BUY' ? 'text-green-600' : 'text-red-600';
                    const signalBg = latestSignal.type === 'BUY' ? 'bg-green-100 dark:bg-green-900' : 'bg-red-100 dark:bg-red-900';
                    
                    latestSignalEl.innerHTML = `
                        <div class="${signalBg} rounded-lg p-4 signal-animation">
                            <div class="text-2xl font-bold ${signalColor}">${latestSignal.type}</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">${latestSignal.symbol}</div>
                            <div class="font-mono text-lg">$${latestSignal.price.toLocaleString()}</div>
                            <div class="text-xs text-gray-500">${latestSignal.timestamp}</div>
                        </div>
                    `;

                    // Update combined history
                    const historyEl = document.getElementById('combinedSignalHistory');
                    const noSignalsEl = document.getElementById('noSignalsMessage');
                    
                    historyEl.innerHTML = '';
                    noSignalsEl.style.display = 'none';
                    
                    this.allSignals.slice(0, 20).forEach(signal => {
                        const signalItem = document.createElement('div');
                        const itemBg = signal.type === 'BUY' ? 'bg-green-100 dark:bg-green-900' : 'bg-red-100 dark:bg-red-900';
                        const itemColor = signal.type === 'BUY' ? 'text-green-600' : 'text-red-600';
                        
                        signalItem.className = `flex justify-between items-center p-3 rounded ${itemBg} mb-2`;
                        signalItem.innerHTML = `
                            <div>
                                <span class="font-semibold ${itemColor}">${signal.type}</span>
                                <span class="text-sm text-gray-600 dark:text-gray-400 ml-2">${signal.symbol}</span>
                                <div class="text-xs text-gray-500">${signal.timestamp}</div>
                            </div>
                            <span class="font-mono text-sm">$${signal.price.toLocaleString()}</span>
                        `;
                        
                        historyEl.appendChild(signalItem);
                    });
                } else {
                    document.getElementById('noSignalsMessage').style.display = 'block';
                }
            }

            updateUI() {
                const pairCount = this.pairs.size;
                document.getElementById('activePairsCount').textContent = `${pairCount} aktif √ßift`;
                
                const noPairsMsg = document.getElementById('noPairsMessage');
                noPairsMsg.style.display = pairCount === 0 ? 'block' : 'none';
            }

            async enableNotifications() {
                if ('Notification' in window) {
                    if (this.notificationsEnabled) {
                        // Disable notifications
                        this.notificationsEnabled = false;
                        this.updateNotificationButton();
                        this.showToast('success', 'Bildirimler', 'Bildirimler kapatƒ±ldƒ±');
                    } else {
                        // Check current permission status
                        let permission = Notification.permission;
                        
                        if (permission === 'denied') {
                            // Show help modal for denied permission
                            this.showPermissionHelp();
                            return;
                        }
                        
                        if (permission === 'default') {
                            // Request permission
                            permission = await Notification.requestPermission();
                        }
                        
                        if (permission === 'granted') {
                            this.notificationsEnabled = true;
                            this.updateNotificationButton();
                            this.showToast('success', 'Ba≈üarƒ±lƒ±!', 'Browser bildirimleri etkinle≈ütirildi');
                            
                            // Test notification
                            setTimeout(() => {
                                new Notification('Test Bildirimi', {
                                    body: 'Bildirimler ba≈üarƒ±yla etkinle≈ütirildi! üéâ',
                                    icon: 'üîî'
                                });
                            }, 1000);
                        } else if (permission === 'denied') {
                            this.showPermissionHelp();
                        } else {
                            this.showToast('danger', 'Hata!', 'Bildirim izni alƒ±namadƒ±');
                        }
                    }
                } else {
                    this.showToast('danger', 'Hata!', 'Bu tarayƒ±cƒ± bildirimleri desteklemiyor');
                }
            }

            showPermissionHelp() {
                // Create help modal
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 m-4 max-w-md w-full border border-gray-200 dark:border-gray-700">
                        <div class="text-center mb-6">
                            <div class="w-16 h-16 bg-red-100 dark:bg-red-900 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                            </div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Bildirim ƒ∞zni Reddedildi</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-6">
                                Tarayƒ±cƒ±nƒ±z bildirimleri engellemi≈ü. Manuel olarak a√ßmanƒ±z gerekiyor.
                            </p>
                        </div>
                        
                        <div class="space-y-4 mb-6">
                            <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                <h4 class="font-semibold text-blue-900 dark:text-blue-300 mb-2">üåê Chrome/Edge i√ßin:</h4>
                                <ol class="text-sm text-blue-800 dark:text-blue-300 space-y-1">
                                    <li>1. Adres √ßubuƒüundaki üîí kilit simgesine tƒ±klayƒ±n</li>
                                    <li>2. "Bildirimler" ‚Üí "ƒ∞zin Ver" se√ßin</li>
                                    <li>3. Sayfayƒ± yenileyin</li>
                                </ol>
                            </div>
                            
                            <div class="p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                                <h4 class="font-semibold text-orange-900 dark:text-orange-300 mb-2">ü¶ä Firefox i√ßin:</h4>
                                <ol class="text-sm text-orange-800 dark:text-orange-300 space-y-1">
                                    <li>1. Adres √ßubuƒüundaki üõ°Ô∏è simgeye tƒ±klayƒ±n</li>
                                    <li>2. "Bildirimler" ayarƒ±nƒ± deƒüi≈ütirin</li>
                                    <li>3. Sayfayƒ± yenileyin</li>
                                </ol>
                            </div>
                            
                            <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                <h4 class="font-semibold text-purple-900 dark:text-purple-300 mb-2">üçé Safari i√ßin:</h4>
                                <ol class="text-sm text-purple-800 dark:text-purple-300 space-y-1">
                                    <li>1. Safari ‚Üí Ayarlar ‚Üí Web Siteleri</li>
                                    <li>2. "Bildirimler" b√∂l√ºm√ºn√º bulun</li>
                                    <li>3. Bu siteyi "ƒ∞zin Ver" olarak ayarlayƒ±n</li>
                                </ol>
                            </div>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="window.location.reload()" class="flex-1 px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-lg font-medium transition-colors">
                                üîÑ Sayfayƒ± Yenile
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors">
                                ‚ùå Kapat
                            </button>
                        </div>
                        
                        <p class="text-xs text-gray-500 dark:text-gray-400 text-center mt-4">
                            üí° ƒ∞pucu: Ses bildirimleri her zaman aktif kalƒ±r
                        </p>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Auto close after 15 seconds
                setTimeout(() => {
                    if (modal.parentNode) {
                        modal.remove();
                    }
                }, 15000);
            }

            updateNotificationButton() {
                const btn = document.getElementById('notificationBtn');
                if (this.notificationsEnabled) {
                    btn.innerHTML = '‚úÖ Bildirimler Aktif';
                    btn.className = 'px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-colors';
                    btn.title = 'Bildirimleri Kapat';
                } else {
                    btn.innerHTML = 'üîî Bildirimleri Etkinle≈ütir';
                    btn.className = 'px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium transition-colors';
                    btn.title = 'Bildirimleri A√ß';
                }
            }

            showNotification(signal) {
                if (!this.notificationsEnabled) return;

                const notification = new Notification(`${signal.type} Sinyali - ${signal.symbol}`, {
                    body: `Fiyat: $${signal.price.toLocaleString()}\nZaman: ${signal.timestamp}`,
                    icon: signal.type === 'BUY' ? 'üü¢' : 'üî¥'
                });

                setTimeout(() => notification.close(), 5000);
            }

            showToast(type, title, message) {
                const toast = document.getElementById('notificationToast');
                const icon = document.getElementById('toastIcon');
                const titleEl = document.getElementById('toastTitle');
                const messageEl = document.getElementById('toastMessage');

                icon.className = `flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center mr-3 ${
                    type === 'success' ? 'notification-success' : 'notification-danger'
                }`;
                icon.querySelector('span').textContent = type === 'success' ? '‚úì' : '!';
                titleEl.textContent = title;
                messageEl.textContent = message;

                toast.classList.remove('translate-x-full');
                
                setTimeout(() => {
                    toast.classList.add('translate-x-full');
                }, 4000);
            }
        }

        // Individual Pair Tracker
        class PairTracker {
            constructor(symbol, interval, emaShort, emaLong, parentApp) {
                this.symbol = symbol;
                this.interval = interval;
                this.emaShort = emaShort;
                this.emaLong = emaLong;
                this.parentApp = parentApp;
                
                this.ws = null;
                this.priceData = [];
                this.emaShortData = [];
                this.emaLongData = [];
                this.pairKey = `${symbol}_${interval}_${emaShort}_${emaLong}`;
                
                this.connect();
            }

            connect() {
                this.updateStatus('connecting', 'Baƒülanƒ±yor...');
                
                if (this.ws) {
                    this.ws.close();
                }

                const stream = `${this.symbol}@kline_${this.interval}`;
                this.ws = new WebSocket(`wss://stream.binance.com:9443/ws/${stream}`);

                this.ws.onopen = () => {
                    this.updateStatus('connected', 'Baƒülandƒ±');
                };

                this.ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    this.handleKlineData(data);
                };

                this.ws.onerror = () => {
                    this.updateStatus('error', 'Baƒülantƒ± Hatasƒ±');
                };

                this.ws.onclose = () => {
                    this.updateStatus('disconnected', 'Baƒülantƒ± Kesildi');
                    setTimeout(() => this.connect(), 5000);
                };
            }

            disconnect() {
                if (this.ws) {
                    this.ws.close();
                    this.ws = null;
                }
            }

            handleKlineData(data) {
                if (!data.k) return;

                const kline = data.k;
                const price = parseFloat(kline.c);

                // Update price display
                const priceEl = document.getElementById(`price_${this.pairKey}`);
                if (priceEl) {
                    priceEl.textContent = `$${price.toLocaleString()}`;
                }

                // Add to price data
                this.priceData.push(price);
                if (this.priceData.length > 200) {
                    this.priceData.shift();
                }

                // Calculate EMAs
                this.calculateEMAs();
                this.checkSignals();
            }

            calculateEMAs() {
                if (this.priceData.length < this.emaLong) return;

                // Calculate EMA Short
                const emaShort = this.calculateEMA(this.priceData, this.emaShort);
                this.emaShortData.push(emaShort);

                // Calculate EMA Long
                const emaLong = this.calculateEMA(this.priceData, this.emaLong);
                this.emaLongData.push(emaLong);

                // Keep only necessary data
                if (this.emaShortData.length > 100) {
                    this.emaShortData.shift();
                }
                if (this.emaLongData.length > 100) {
                    this.emaLongData.shift();
                }

                // Update UI
                const emaShortEl = document.getElementById(`ema_short_${this.pairKey}`);
                const emaLongEl = document.getElementById(`ema_long_${this.pairKey}`);
                
                if (emaShortEl) emaShortEl.textContent = `$${emaShort.toLocaleString()}`;
                if (emaLongEl) emaLongEl.textContent = `$${emaLong.toLocaleString()}`;
            }

            calculateEMA(data, period) {
                const multiplier = 2 / (period + 1);
                let ema = data[0];

                for (let i = 1; i < data.length; i++) {
                    ema = (data[i] * multiplier) + (ema * (1 - multiplier));
                }

                return ema;
            }

            checkSignals() {
                if (this.emaShortData.length < 2 || this.emaLongData.length < 2) return;

                const currentEmaShort = this.emaShortData[this.emaShortData.length - 1];
                const previousEmaShort = this.emaShortData[this.emaShortData.length - 2];
                const currentEmaLong = this.emaLongData[this.emaLongData.length - 1];
                const previousEmaLong = this.emaLongData[this.emaLongData.length - 2];

                let signal = null;

                // Buy signal: EMA Short crosses above EMA Long
                if (previousEmaShort < previousEmaLong && currentEmaShort > currentEmaLong) {
                    signal = 'BUY';
                }
                // Sell signal: EMA Short crosses below EMA Long
                else if (previousEmaShort > previousEmaLong && currentEmaShort < currentEmaLong) {
                    signal = 'SELL';
                }

                if (signal) {
                    this.addSignal(signal);
                }
            }

            addSignal(type) {
                const timestamp = new Date().toLocaleString();
                const price = this.priceData[this.priceData.length - 1];
                
                const signalData = {
                    type,
                    price,
                    timestamp,
                    symbol: this.symbol.toUpperCase(),
                    interval: this.interval,
                    emaShort: this.emaShort,
                    emaLong: this.emaLong
                };

                // Update pair card signal display
                const signalEl = document.getElementById(`signal_${this.pairKey}`);
                if (signalEl) {
                    const signalColor = type === 'BUY' ? 'text-green-600' : 'text-red-600';
                    const signalBg = type === 'BUY' ? 'bg-green-100 dark:bg-green-900' : 'bg-red-100 dark:bg-red-900';
                    
                    signalEl.innerHTML = `
                        <div class="${signalBg} rounded px-2 py-1">
                            <span class="font-bold ${signalColor}">${type}</span>
                            <div class="text-xs text-gray-500">${timestamp.split(' ')[1]}</div>
                        </div>
                    `;
                }

                // Add to parent app's signal collection
                this.parentApp.addSignal(signalData);
            }

            updateStatus(status, text) {
                const statusEl = document.getElementById(`status_${this.pairKey}`);
                if (!statusEl) return;
                
                const colors = {
                    connecting: 'bg-yellow-500',
                    connected: 'bg-green-500',
                    error: 'bg-red-500',
                    disconnected: 'bg-gray-500'
                };

                statusEl.innerHTML = `
                    <span class="w-2 h-2 ${colors[status]} rounded-full inline-block"></span>
                    ${text}
                `;
            }
        }

        // TradingView Chart Manager
        class TradingViewChart {
            constructor() {
                this.currentSymbol = 'BTCUSDT';
                this.isLoaded = false;
                this.widget = null;
                this.bindEvents();
            }

            bindEvents() {
                document.getElementById('chartType').addEventListener('change', (e) => {
                    this.switchChart(e.target.value);
                });

                document.getElementById('chartSymbol').addEventListener('change', (e) => {
                    this.currentSymbol = this.mapSymbolToTradingView(e.target.value);
                    if (document.getElementById('chartType').value === 'tradingview') {
                        this.loadWidget();
                    }
                });
            }

            mapSymbolToTradingView(binanceSymbol) {
                const symbolMap = {
                    'btcusdt': 'BINANCE:BTCUSDT',
                    'ethusdt': 'BINANCE:ETHUSDT',
                    'adausdt': 'BINANCE:ADAUSDT',
                    'bnbusdt': 'BINANCE:BNBUSDT',
                    'solusdt': 'BINANCE:SOLUSDT'
                };
                return symbolMap[binanceSymbol] || 'BINANCE:BTCUSDT';
            }

            switchChart(type) {
                const customContainer = document.getElementById('customChartContainer');
                const tradingViewContainer = document.getElementById('tradingViewContainer');

                if (type === 'tradingview') {
                    customContainer.style.display = 'none';
                    tradingViewContainer.style.display = 'block';
                    this.loadWidget();
                } else {
                    customContainer.style.display = 'block';
                    tradingViewContainer.style.display = 'none';
                }
            }

            loadWidget() {
                const container = document.getElementById('tradingview_widget');
                if (!container) return;

                // Clear previous widget
                container.innerHTML = '';

                try {
                    // Create TradingView widget script
                    const script = document.createElement('script');
                    script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js';
                    script.async = true;
                    
                    const isDark = document.documentElement.classList.contains('dark');
                    
                    script.innerHTML = JSON.stringify({
                        "allow_symbol_change": true,
                        "calendar": false,
                        "details": false,
                        "hide_side_toolbar": true,
                        "hide_top_toolbar": false,
                        "hide_legend": false,
                        "hide_volume": false,
                        "hotlist": false,
                        "interval": "5",
                        "locale": "tr",
                        "save_image": true,
                        "style": "1",
                        "symbol": this.currentSymbol,
                        "theme": isDark ? "dark" : "light",
                        "timezone": "Etc/UTC",
                        "backgroundColor": isDark ? "#1f2937" : "#ffffff",
                        "gridColor": "rgba(46, 46, 46, 0.06)",
                        "watchlist": [],
                        "withdateranges": true,
                        "compareSymbols": [],
                        "studies": ["MAExp@tv-basicstudies"],
                        "autosize": true
                    });

                    container.appendChild(script);
                    this.isLoaded = true;

                    console.log('TradingView widget loaded for:', this.currentSymbol);
                } catch (error) {
                    console.error('TradingView widget load error:', error);
                    this.showFallbackMessage();
                }
            }

            showFallbackMessage() {
                const container = document.getElementById('tradingview_widget');
                container.innerHTML = `
                    <div class="flex items-center justify-center h-full">
                        <div class="text-center">
                            <div class="text-6xl mb-4">üìä</div>
                            <h3 class="text-lg font-semibold mb-2">TradingView Y√ºklenemedi</h3>
                            <p class="text-gray-600 dark:text-gray-400 mb-4">CSP kƒ±sƒ±tlamalarƒ± nedeniyle widget y√ºklenemedi</p>
                            <button onclick="document.getElementById('chartType').value='custom'; document.getElementById('chartType').dispatchEvent(new Event('change'))" 
                                    class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
                                Custom Chart'a Ge√ß
                            </button>
                        </div>
                    </div>
                `;
            }

            updateTheme() {
                if (this.isLoaded && document.getElementById('chartType').value === 'tradingview') {
                    setTimeout(() => this.loadWidget(), 100);
                }
            }
        }

        // Initialize app
        initializeTheme();
        const multiPairApp = new MultiPairTradingSignals();
        const realTimePriceChart = new RealTimePriceChart();
        const tradingViewChart = new TradingViewChart();

        // Update TradingView theme on theme change
        document.getElementById('themeToggle').addEventListener('click', () => {
            setTimeout(() => tradingViewChart.updateTheme(), 100);
        });
    </script>
</body>
</html>
